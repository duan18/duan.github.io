import{_ as x,o as R,c as A,a as S,w as b,v as C,t as D}from"./index.6e7c5278.js";var E=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function O(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var B={exports:{}},_={exports:{}};/*!
 * 
 * js-audio-recorder - js audio recorder plugin
 * 
 * @version v1.0.7
 * @homepage https://github.com/2fps/recorder
 * @author 2fps <echoweb@126.com> (https://www.zhuyuntao.cn)
 * @license MIT
 *         
 */(function(g,m){(function(v,c){g.exports=c()})(E,function(){return function(v){var c={};function a(o){if(c[o])return c[o].exports;var t=c[o]={i:o,l:!1,exports:{}};return v[o].call(t.exports,t,t.exports,a),t.l=!0,t.exports}return a.m=v,a.c=c,a.d=function(o,t,r){a.o(o,t)||Object.defineProperty(o,t,{enumerable:!0,get:r})},a.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},a.t=function(o,t){if(1&t&&(o=a(o)),8&t||4&t&&typeof o=="object"&&o&&o.__esModule)return o;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:o}),2&t&&typeof o!="string")for(var e in o)a.d(r,e,function(i){return o[i]}.bind(null,e));return r},a.n=function(o){var t=o&&o.__esModule?function(){return o.default}:function(){return o};return a.d(t,"a",t),t},a.o=function(o,t){return Object.prototype.hasOwnProperty.call(o,t)},a.p="",a(a.s=1)}([function(v,c,a){function o(t,r,e){for(var i=0;i<e.length;i++)t.setUint8(r+i,e.charCodeAt(i))}Object.defineProperty(c,"__esModule",{value:!0}),c.compress=function(t,r,e){for(var i=r/e,h=Math.max(i,1),l=t.left,s=t.right,n=Math.floor((l.length+s.length)/i),d=new Float32Array(n),u=0,w=0;u<n;){var f=Math.floor(w);d[u]=l[f],u++,s.length&&(d[u]=s[f],u++),w+=h}return d},c.encodePCM=function(t,r,e){e===void 0&&(e=!0);var i=0,h=t.length*(r/8),l=new ArrayBuffer(h),s=new DataView(l);if(r===8)for(var n=0;n<t.length;n++,i++){var d=(u=Math.max(-1,Math.min(1,t[n])))<0?128*u:127*u;d=+d+128,s.setInt8(i,d)}else for(n=0;n<t.length;n++,i+=2){var u=Math.max(-1,Math.min(1,t[n]));s.setInt16(i,u<0?32768*u:32767*u,e)}return s},c.encodeWAV=function(t,r,e,i,h,l){l===void 0&&(l=!0);var s=e>r?r:e,n=h,d=new ArrayBuffer(44+t.byteLength),u=new DataView(d),w=i,f=0;o(u,f,"RIFF"),f+=4,u.setUint32(f,36+t.byteLength,l),o(u,f+=4,"WAVE"),o(u,f+=4,"fmt "),f+=4,u.setUint32(f,16,l),f+=4,u.setUint16(f,1,l),f+=2,u.setUint16(f,w,l),f+=2,u.setUint32(f,s,l),f+=4,u.setUint32(f,w*s*(n/8),l),f+=4,u.setUint16(f,w*(n/8),l),f+=2,u.setUint16(f,n,l),o(u,f+=2,"data"),f+=4,u.setUint32(f,t.byteLength,l),f+=4;for(var y=0;y<t.byteLength;)u.setUint8(f,t.getUint8(y)),f++,y++;return u}},function(v,c,a){var o,t=this&&this.__extends||(o=function(l,s){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,d){n.__proto__=d}||function(n,d){for(var u in d)d.hasOwnProperty(u)&&(n[u]=d[u])})(l,s)},function(l,s){function n(){this.constructor=l}o(l,s),l.prototype=s===null?Object.create(s):(n.prototype=s.prototype,new n)});Object.defineProperty(c,"__esModule",{value:!0});var r=a(2),e=a(0),i=a(3),h=function(l){function s(n){n===void 0&&(n={});var d=l.call(this,n)||this;return d.isrecording=!1,d.ispause=!1,d.isplaying=!1,d}return t(s,l),s.prototype.setOption=function(n){n===void 0&&(n={}),this.setNewOption(n)},s.prototype.start=function(){return this.isrecording?Promise.reject():(this.isrecording=!0,this.startRecord())},s.prototype.pause=function(){this.isrecording&&!this.ispause&&(this.ispause=!0,this.pauseRecord())},s.prototype.resume=function(){this.isrecording&&this.ispause&&(this.ispause=!1,this.resumeRecord())},s.prototype.stop=function(){this.isrecording&&(this.isrecording=!1,this.ispause=!1,this.stopRecord())},s.prototype.play=function(){this.stop(),this.isplaying=!0,this.onplay&&this.onplay(),i.default.addPlayEnd(this.onplayend);var n=this.getWAV();n.byteLength>44&&i.default.play(n.buffer)},s.prototype.getPlayTime=function(){return i.default.getPlayTime()},s.prototype.pausePlay=function(){!this.isrecording&&this.isplaying&&(this.isplaying=!1,this.onpauseplay&&this.onpauseplay(),i.default.pausePlay())},s.prototype.resumePlay=function(){this.isrecording||this.isplaying||(this.isplaying=!0,this.onresumeplay&&this.onresumeplay(),i.default.resumePlay())},s.prototype.stopPlay=function(){this.isrecording||(this.isplaying=!1,this.onstopplay&&this.onstopplay(),i.default.stopPlay())},s.prototype.destroy=function(){return i.default.destroyPlay(),this.destroyRecord()},s.prototype.getRecordAnalyseData=function(){return this.getAnalyseData()},s.prototype.getPlayAnalyseData=function(){return i.default.getAnalyseData()},s.prototype.getPCM=function(){this.stop();var n=this.getData();return n=e.compress(n,this.inputSampleRate,this.outputSampleRate),e.encodePCM(n,this.oututSampleBits,this.littleEdian)},s.prototype.getPCMBlob=function(){return new Blob([this.getPCM()])},s.prototype.downloadPCM=function(n){n===void 0&&(n="recorder");var d=this.getPCMBlob();r.downloadPCM(d,n)},s.prototype.getWAV=function(){var n=this.getPCM();return e.encodeWAV(n,this.inputSampleRate,this.outputSampleRate,this.config.numChannels,this.oututSampleBits,this.littleEdian)},s.prototype.getWAVBlob=function(){return new Blob([this.getWAV()],{type:"audio/wav"})},s.prototype.downloadWAV=function(n){n===void 0&&(n="recorder");var d=this.getWAVBlob();r.downloadWAV(d,n)},s.prototype.download=function(n,d,u){r.download(n,d,u)},s.prototype.getChannelData=function(){var n=this.getPCM(),d=n.byteLength,u=this.littleEdian,w={left:null,right:null};if(this.config.numChannels===2){var f=new DataView(new ArrayBuffer(d/2)),y=new DataView(new ArrayBuffer(d/2));if(this.config.sampleBits===16)for(var p=0;p<d/2;p+=2)f.setInt16(p,n.getInt16(2*p,u),u),y.setInt16(p,n.getInt16(2*p+2,u),u);else for(p=0;p<d/2;p+=2)f.setInt8(p,n.getInt8(2*p)),y.setInt8(p,n.getInt8(2*p+1));w.left=f,w.right=y}else w.left=n;return w},s}(a(5).default);c.default=h},function(v,c,a){function o(t,r,e){var i=document.createElement("a");i.href=window.URL.createObjectURL(t),i.download=r+"."+e,i.click()}Object.defineProperty(c,"__esModule",{value:!0}),c.downloadWAV=function(t,r){r===void 0&&(r="recorder"),o(t,r,"wav")},c.downloadPCM=function(t,r){r===void 0&&(r="recorder"),o(t,r,"pcm")},c.download=function(t,r,e){return o(t,r,e)}},function(v,c,a){Object.defineProperty(c,"__esModule",{value:!0});var o=a(4),t=null,r=0,e=0,i=null,h=null,l=null,s=!1,n=0,d=function(){};function u(){return s=!1,i.decodeAudioData(l.slice(0),function(y){(t=i.createBufferSource()).onended=function(){s||(n=i.currentTime-e+r,d())},t.buffer=y,t.connect(h),h.connect(i.destination),t.start(0,r),e=i.currentTime},function(y){o.throwError(y)})}function w(){t&&(t.stop(),t=null)}var f=function(){function y(){}return y.play=function(p){return i||(i=new(window.AudioContext||window.webkitAudioContext),(h=i.createAnalyser()).fftSize=2048),this.stopPlay(),l=p,n=0,u()},y.pausePlay=function(){w(),r+=i.currentTime-e,s=!0},y.resumePlay=function(){return u()},y.stopPlay=function(){r=0,l=null,w()},y.destroyPlay=function(){this.stopPlay()},y.getAnalyseData=function(){var p=new Uint8Array(h.frequencyBinCount);return h.getByteTimeDomainData(p),p},y.addPlayEnd=function(p){p===void 0&&(p=function(){}),d=p},y.getPlayTime=function(){var p=s?r:i.currentTime-e+r;return n||p},y}();c.default=f},function(v,c,a){Object.defineProperty(c,"__esModule",{value:!0}),c.throwError=function(o){throw new Error(o)}},function(v,c,a){Object.defineProperty(c,"__esModule",{value:!0});var o=a(0),t=function(){function r(e){e===void 0&&(e={}),this.size=0,this.lBuffer=[],this.rBuffer=[],this.tempPCM=[],this.inputSampleBits=16,this.fileSize=0,this.duration=0,this.needRecord=!0;var i,h=new(window.AudioContext||window.webkitAudioContext);this.inputSampleRate=h.sampleRate,this.setNewOption(e),this.littleEdian=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256),r.initUserMedia()}return r.prototype.setNewOption=function(e){e===void 0&&(e={}),this.config={sampleBits:~[8,16].indexOf(e.sampleBits)?e.sampleBits:16,sampleRate:~[8e3,11025,16e3,22050,24e3,44100,48e3].indexOf(e.sampleRate)?e.sampleRate:this.inputSampleRate,numChannels:~[1,2].indexOf(e.numChannels)?e.numChannels:1},this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits},r.prototype.startRecord=function(){var e=this;return this.context&&this.destroyRecord(),this.initRecorder(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(i){e.audioInput=e.context.createMediaStreamSource(i),e.stream=i}).then(function(){e.audioInput.connect(e.analyser),e.analyser.connect(e.recorder),e.recorder.connect(e.context.destination)})},r.prototype.pauseRecord=function(){this.needRecord=!1},r.prototype.resumeRecord=function(){this.needRecord=!0},r.prototype.stopRecord=function(){this.audioInput&&this.audioInput.disconnect(),this.source&&this.source.stop(),this.recorder.disconnect(),this.analyser.disconnect(),this.needRecord=!0},r.prototype.destroyRecord=function(){return this.clearRecordStatus(),this.stopStream(),this.closeAudioContext()},r.prototype.getAnalyseData=function(){var e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(e),e},r.prototype.getData=function(){return this.flat()},r.prototype.clearRecordStatus=function(){this.lBuffer.length=0,this.rBuffer.length=0,this.size=0,this.fileSize=0,this.PCM=null,this.audioInput=null,this.duration=0},r.prototype.flat=function(){var e=null,i=new Float32Array(0);this.config.numChannels===1?e=new Float32Array(this.size):(e=new Float32Array(this.size/2),i=new Float32Array(this.size/2));for(var h=0,l=0;l<this.lBuffer.length;l++)e.set(this.lBuffer[l],h),h+=this.lBuffer[l].length;for(h=0,l=0;l<this.rBuffer.length;l++)i.set(this.rBuffer[l],h),h+=this.rBuffer[l].length;return{left:e,right:i}},r.prototype.initRecorder=function(){var e=this;this.clearRecordStatus(),this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048;var i=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=i.apply(this.context,[4096,this.config.numChannels,this.config.numChannels]),this.recorder.onaudioprocess=function(h){if(e.needRecord){var l,s=h.inputBuffer.getChannelData(0),n=null;e.lBuffer.push(new Float32Array(s)),e.size+=s.length,e.config.numChannels===2&&(n=h.inputBuffer.getChannelData(1),e.rBuffer.push(new Float32Array(n)),e.size+=n.length),e.fileSize=Math.floor(e.size/Math.max(e.inputSampleRate/e.outputSampleRate,1))*(e.oututSampleBits/8),l=100*Math.max.apply(Math,s),e.duration+=4096/e.inputSampleRate,e.onprocess&&e.onprocess(e.duration),e.onprogress&&e.onprogress({duration:e.duration,fileSize:e.fileSize,vol:l})}}},r.prototype.stopStream=function(){this.stream&&this.stream.getTracks&&(this.stream.getTracks().forEach(function(e){return e.stop()}),this.stream=null)},r.prototype.closeAudioContext=function(){return this.context&&this.context.close&&this.context.state!=="closed"?this.context.close():new Promise(function(e){e()})},r.initUserMedia=function(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(e){var i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return i?new Promise(function(h,l){i.call(navigator,e,h,l)}):Promise.reject(new Error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 getUserMedia !"))})},r.prototype.transformIntoPCM=function(e,i){var h=new Float32Array(e),l=new Float32Array(i),s=o.compress({left:h,right:l},this.inputSampleRate,this.outputSampleRate);return o.encodePCM(s,this.oututSampleBits,this.littleEdian)},r.getPermission=function(){return this.initUserMedia(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){e&&e.getTracks().forEach(function(i){return i.stop()})})},r}();c.default=t}]).default})})(_);(function(g){g.exports=_.exports})(B);const M=O(B.exports),P={fail:0,recording:1,continue:2,finish:3},U={name:"VoicePopup",data(){return{voiceShow:!1,voiceRecordState:P.recording,StateEnum:P,audioSrc:"",recorder:null,userVoiceComment:"aaaa"}},mounted(){this.recorderInit()},beforeDestroy(){this.handleDestroy()},methods:{recorderInit(){this.recorder=new M({sampleBits:16,sampleRate:16e3,numChannels:1}),console.log("\u5B9E\u4F8B\u5316\u8BED\u97F3\u5BF9\u8C61: recorder",this.recorder)},getPermission(){M.getPermission().then(()=>{console.log("\u7ED9\u6743\u9650\u4E86"),this.handleStart()},g=>{console.log("getPermission >> error",g)})},handleContinue(){this.handleStart(),this.voiceRecordState=P.continue},handleStart(){console.log("\u5F00\u59CB\u5F55\u97F3"),this.voiceRecordState=P.recording,this.recorder.start().then(()=>{this.handleProgress()},g=>{console.log(g)})},handleProgress(){this.recorder.onprogress=g=>{console.log("\u5F55\u97F3\u5927\u5C0F(\u5B57\u8282)",g.fileSize)}},handleStop(){console.log("\u505C\u6B62\u5F55\u97F3"),this.recorder.stop(),this.sendAudio()},handleDestroy(){console.log("\u9500\u6BC1\u5B9E\u4F8B"),this.recorder&&(this.recorder.destroy(),this.recorder=null)},getRecorder(){let g=this.recorder.duration,m=this.recorder.fileSize;console.log("duration==",g),console.log("fileSize==",m);let v=this.recorder.getPCMBlob(),c=this.recorder.getWAVBlob();console.log("PCMBlob==",v),console.log("wav==",c)},downPCM(){this.recorder.downloadPCM("testpcm")},downWAV(){this.recorder.downloadWAV("testwav")},sendAudio(g=""){let m=this.recorder.getWAVBlob();console.log("blob\uFF1A",m);let v=new Blob([m],{type:"audio/wav"});new File([v],new Date().getTime()+".pcm");const c=window.URL.createObjectURL(m);this.audioSrc=c,console.log("fileOfBlob",c)},voiceClose(){this.voiceShow=!1,this.recorder.stop(),this.$emit("voiceClose")},voiceCloseSend(){this.voiceClose(),this.$emit("voiceCloseSend",this.userVoiceComment)},handleEdit(){}}},V={class:"voice-popup"},j=S("div",{class:"voice-title"},null,-1),I={class:"voice-content"},z={class:"voice-info"},k={key:0,class:"voice-record-finish"},T={key:1},W={class:"voice-record"},F=["src"];function L(g,m,v,c,a,o){return R(),A("div",null,[S("div",V,[j,S("div",I,[b(S("div",{class:"voice-info",onClick:m[0]||(m[0]=(...t)=>o.handleStart&&o.handleStart(...t))},"\u6211\u5728\u542C\uFF0C\u8BF7\u8BF4\u8BDD",512),[[C,a.voiceRecordState===a.StateEnum.recording]]),b(S("div",z,"\u6CA1\u542C\u6E05\uFF0C\u8BF7\u518D\u8BF4\u4E00\u904D",512),[[C,a.voiceRecordState===a.StateEnum.fail]]),b(S("div",{class:"voice-result",onClick:m[1]||(m[1]=(...t)=>o.handleEdit&&o.handleEdit(...t))},D(a.userVoiceComment),513),[[C,a.voiceRecordState===a.StateEnum.continue||a.voiceRecordState===a.StateEnum.finish]])]),a.voiceRecordState===a.StateEnum.finish?(R(),A("div",k,[S("button",{class:"voice-record-start",onClick:m[2]||(m[2]=(...t)=>o.handleContinue&&o.handleContinue(...t))},"\u5F00\u59CB\u8BF4\u8BDD"),S("button",{class:"voice-record-send",onClick:m[3]||(m[3]=(...t)=>o.voiceCloseSend&&o.voiceCloseSend(...t))},"\u53D1\u9001")])):(R(),A("div",T,[b(S("button",W,[S("span",{onClick:m[4]||(m[4]=(...t)=>o.handleStop&&o.handleStop(...t))},"\u6B63\u5728\u6536\u97F3 \u70B9\u51FB\u505C\u6B62")],512),[[C,a.voiceRecordState===a.StateEnum.recording||a.voiceRecordState===a.StateEnum.continue]]),b(S("button",{class:"voice-record",onClick:m[5]||(m[5]=(...t)=>o.handleContinue&&o.handleContinue(...t))},[b(S("span",null,"\u70B9\u51FB\u5F00\u59CB\u8BF4\u8BDD",512),[[C,a.voiceRecordState===a.StateEnum.fail]])],512),[[C,a.voiceRecordState===a.StateEnum.fail]])]))]),S("audio",{src:a.audioSrc,controls:""},null,8,F)])}const G=x(U,[["render",L]]);export{G as default};
